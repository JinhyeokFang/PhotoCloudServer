"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,n,r){return n&&_defineProperties(e.prototype,n),r&&_defineProperties(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0});var mongoose_1=require("mongoose"),crypto_1=require("../utils/crypto"),User=function(){function e(){_classCallCheck(this,e),this.userSchema=new mongoose_1.Schema({username:String,password:String,photos:Array}),this.userModelInstance=mongoose_1.model("user",this.userSchema)}return _createClass(e,[{key:"login",value:function(n,t){var o=this;return new Promise(function(r,e){o.userModelInstance.findOne({username:crypto_1.encrypt(n),password:crypto_1.encrypt(t)},function(e,n){r(e?{err:e}:null==n?{err:"the user not found"}:{})})})}},{key:"register",value:function(t,o){var s=this;return new Promise(function(r,e){s.userModelInstance.findOne({username:crypto_1.encrypt(t)},function(e,n){e?r({err:e}):null==n?new s.userModelInstance({username:crypto_1.encrypt(t),password:crypto_1.encrypt(o)}).save(function(e){r(e?{err:e}:{})}):r({err:"the user already exist."})})})}},{key:"uploadPhoto",value:function(o,s){var u=this;return new Promise(function(t,e){u.userModelInstance.findOne({username:crypto_1.encrypt(o)},function(e,n){if(e)t({err:e});else if(null==n)t({err:"the user not found"});else{var r=n.photos;r.push({url:s,date:(new Date).getTime().toString()}),u.userModelInstance.updateOne({username:crypto_1.encrypt(o)},{photos:r},function(e){t(e?{err:e}:{})})}})})}},{key:"showPhotos",value:function(n){var t=this;return new Promise(function(r,e){t.userModelInstance.findOne({username:crypto_1.encrypt(n)},function(e,n){r(e?{err:e}:null==n?{err:"the user not found"}:{data:n.photos})})})}},{key:"removeImage",value:function(o,s){var u=this;return new Promise(function(t,e){u.userModelInstance.findOne({username:crypto_1.encrypt(o)},function(e,n){if(e)t({err:e});else if(null==n)t({err:"the user not found"});else{var r=n.photos.findIndex(function(e){return e.date==s});-1==r?t({err:"the image not found"}):(n.photos.splice(r,1),u.userModelInstance.updateOne({username:crypto_1.encrypt(o)},{photos:n.photos},function(e){t(e?{err:e}:{})}))}})})}}]),e}();exports.default=new User;