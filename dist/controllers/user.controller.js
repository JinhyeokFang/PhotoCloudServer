"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_get2=_interopRequireDefault(require("@babel/runtime/helpers/get")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),__awaiter=function(e,u,a,l){return new(a=a||Promise)(function(t,r){function n(e){try{s(l.next(e))}catch(e){r(e)}}function o(e){try{s(l.throw(e))}catch(e){r(e)}}function s(e){e.done?t(e.value):function(t){return t instanceof a?t:new a(function(e){e(t)})}(e.value).then(n,o)}s((l=l.apply(e,u||[])).next())})},__importDefault=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var controller_1=__importDefault(require("./controller")),user_model_1=__importDefault(require("../models/user.model")),jwt_1=require("../utils/jwt"),UserController=function(e){function t(){return(0,_classCallCheck2.default)(this,t),(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(t).apply(this,arguments))}return(0,_inherits2.default)(t,e),(0,_createClass2.default)(t,[{key:"addImage",value:function(u,a){var e=this,l=Object.create(null,{ResponseBadRequest:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseBadRequest",e)}},ResponseUnauthorized:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseUnauthorized",e)}},ResponseNotFound:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseNotFound",e)}},ResponseSuccess:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseSuccess",e)}},ResponseInternalServerError:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseInternalServerError",e)}}});return __awaiter(this,void 0,void 0,_regenerator.default.mark(function e(){var t,r,n,o,s;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.body,r=t.token,n=t.date,u.file){e.next=4;break}return l.ResponseBadRequest.call(this,a,{err:"file not found"}),e.abrupt("return");case 4:if(o=u.file.filename,jwt_1.isVaildToken(r)){e.next=8;break}return l.ResponseUnauthorized.call(this,a,{err:"token is invalid"}),e.abrupt("return");case 8:return e.next=10,user_model_1.default.uploadPhoto(jwt_1.decodeToken(r).username,o,n);case 10:"the user not found"==(s=e.sent).err?l.ResponseNotFound.call(this,a,{err:s.err}):"the image is already exist"==s.err?l.ResponseSuccess.call(this,a,{message:"the image is already exist"}):s.err?l.ResponseInternalServerError.call(this,a,{err:s.err}):l.ResponseSuccess.call(this,a,{});case 12:case"end":return e.stop()}},e,this)}))}},{key:"showImages",value:function(n,o){var e=this,s=Object.create(null,{ResponseUnauthorized:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseUnauthorized",e)}},ResponseNotFound:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseNotFound",e)}},ResponseInternalServerError:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseInternalServerError",e)}},ResponseSuccess:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseSuccess",e)}}});return __awaiter(this,void 0,void 0,_regenerator.default.mark(function e(){var t,r;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.body.token,jwt_1.isVaildToken(t)){e.next=4;break}return s.ResponseUnauthorized.call(this,o,{err:"token is invalid"}),e.abrupt("return");case 4:return e.next=6,user_model_1.default.showPhotos(jwt_1.decodeToken(t).username);case 6:"the user not found"==(r=e.sent).err?s.ResponseNotFound.call(this,o,{err:r.err}):r.err?s.ResponseInternalServerError.call(this,o,{err:r.err}):s.ResponseSuccess.call(this,o,{photos:r.data});case 8:case"end":return e.stop()}},e,this)}))}},{key:"removeImage",value:function(s,u){var e=this,a=Object.create(null,{ResponseUnauthorized:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseUnauthorized",e)}},ResponseBadRequest:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseBadRequest",e)}},ResponseNotFound:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseNotFound",e)}},ResponseInternalServerError:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseInternalServerError",e)}},ResponseSuccess:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(t.prototype),"ResponseSuccess",e)}}});return __awaiter(this,void 0,void 0,_regenerator.default.mark(function e(){var t,r,n,o;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.body,r=t.token,n=t.imageDate,jwt_1.isVaildToken(r)){e.next=4;break}return a.ResponseUnauthorized.call(this,u,{err:"token is invalid"}),e.abrupt("return");case 4:return e.next=6,user_model_1.default.removeImage(jwt_1.decodeToken(r).username,n);case 6:"the user not found"==(o=e.sent).err?a.ResponseBadRequest.call(this,u,{err:o.err}):"the image not found"==o.err?a.ResponseNotFound.call(this,u,{err:o.err}):o.err?a.ResponseInternalServerError.call(this,u,{err:o.err}):a.ResponseSuccess.call(this,u,{});case 8:case"end":return e.stop()}},e,this)}))}}]),t}(controller_1.default);exports.default=new UserController;