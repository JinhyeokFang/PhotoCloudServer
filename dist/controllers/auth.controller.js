"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_get2=_interopRequireDefault(require("@babel/runtime/helpers/get")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),__awaiter=function(e,s,a,l){return new(a=a||Promise)(function(r,t){function n(e){try{u(l.next(e))}catch(e){t(e)}}function o(e){try{u(l.throw(e))}catch(e){t(e)}}function u(e){e.done?r(e.value):function(r){return r instanceof a?r:new a(function(e){e(r)})}(e.value).then(n,o)}u((l=l.apply(e,s||[])).next())})},__importDefault=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var jwt_1=require("../utils/jwt"),controller_1=__importDefault(require("./controller")),user_model_1=__importDefault(require("../models/user.model")),AuthController=function(e){function r(){return(0,_classCallCheck2.default)(this,r),(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(r).apply(this,arguments))}return(0,_inherits2.default)(r,e),(0,_createClass2.default)(r,[{key:"login",value:function(u,s){var e=this,a=Object.create(null,{ResponseNotFound:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(r.prototype),"ResponseNotFound",e)}},ResponseInternalServerError:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(r.prototype),"ResponseInternalServerError",e)}},ResponseSuccess:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(r.prototype),"ResponseSuccess",e)}}});return __awaiter(this,void 0,void 0,_regenerator.default.mark(function e(){var r,t,n,o;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.body,t=r.username,n=r.password,e.next=3,user_model_1.default.login(t,n);case 3:"the user not found"==(o=e.sent).err?a.ResponseNotFound.call(this,s,{}):o.err?a.ResponseInternalServerError.call(this,s,{err:o.err}):a.ResponseSuccess.call(this,s,{token:jwt_1.encodeToken({username:t,time:(new Date).getTime()})});case 5:case"end":return e.stop()}},e,this)}))}},{key:"register",value:function(u,s){var e=this,a=Object.create(null,{ResponseForbidden:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(r.prototype),"ResponseForbidden",e)}},ResponseInternalServerError:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(r.prototype),"ResponseInternalServerError",e)}},ResponseSuccess:{get:function(){return(0,_get2.default)((0,_getPrototypeOf2.default)(r.prototype),"ResponseSuccess",e)}}});return __awaiter(this,void 0,void 0,_regenerator.default.mark(function e(){var r,t,n,o;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.body,t=r.username,n=r.password,e.next=3,user_model_1.default.register(t,n);case 3:"the user already exist."==(o=e.sent).err?a.ResponseForbidden.call(this,s,{err:o.err}):o.err?a.ResponseInternalServerError.call(this,s,{err:o.err}):a.ResponseSuccess.call(this,s,{token:jwt_1.encodeToken({username:t,time:(new Date).getTime()})});case 5:case"end":return e.stop()}},e,this)}))}}]),r}(controller_1.default);exports.default=new AuthController;